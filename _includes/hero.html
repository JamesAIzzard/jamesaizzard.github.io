<section id="hero">

  <div class="container">

    <h1 id="hero-title">
      Engineering Design for <br>
      <span class="slot-viewport" aria-live="polite" data-hold="1700" data-speed="600">
        <span class="slot-reel">
          <span class="slot-item">Startups</span>
          <span class="slot-item">Founders</span>
          <span class="slot-item">Researchers</span>
          <span class="slot-item">Scientists</span>
          <span class="slot-item">Creators</span>
          <span class="slot-item">Labs</span>
          <span class="slot-item">Inventors</span>
          <span class="slot-item slot-clone">Startups</span>
        </span>
      </span>
    </h1>

    <p id="hero-subtitle">
      <span class="hero-emph">Chartered Mechanical Engineer</span> specialising in efficient, agile prototype development under tight timelines & budgets.
    </p>

    {% include cta-form.html %}

    <figure id="hero-figure" class="drop-shadow edge-width">
      <img class="hero-slide" src="assets/images/hero_screenshot.png" alt="" aria-hidden="true">
      <img class="hero-slide" src="assets/images/hero_screenshot_2.png" alt="" aria-hidden="true">
      <img class="hero-slide" src="assets/images/hero_screenshot_3.png" alt="" aria-hidden="true">
      <figcaption class="visually-hidden">Example CAD work</figcaption>
    </figure>

    <script>
      (function () {
        function initFigure() {
          var fig = document.getElementById('hero-figure');
          if (!fig) return;
          var slides = fig.querySelectorAll('.hero-slide');
          var count = slides.length;
          if (count <= 1) return; // nothing to rotate

          // Respect reduced motion: keep first image only
          var reduce = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
          if (reduce) return;

          // Mark ready to disable no-JS fallback CSS
          fig.classList.add('js-ready');

          // Configurable durations (ms) via data attributes if desired
          var SEGMENT = parseInt(fig.getAttribute('data-segment'), 10); // ms visible per image
          var FADE_ATTR = parseInt(fig.getAttribute('data-fade'), 10); // ms for crossfade
          var DURATION = isNaN(SEGMENT) ? 6000 : SEGMENT;
          var FADE = isNaN(FADE_ATTR) ? 900 : FADE_ATTR;  // matches CSS --fade

          // Ensure CSS transition is at least as fast as FADE
          for (var i = 0; i < count; i++) {
            slides[i].style.setProperty('--fade', FADE + 'ms');
          }

          var index = 0;
          slides[index].classList.add('active');

          setInterval(function () {
            var prev = index;
            index = (index + 1) % count;
            slides[index].classList.add('active');
            slides[prev].classList.remove('active');
          }, DURATION);
        }

        function initSlot() {
          var viewport = document.querySelector('#hero-title .slot-viewport');
          if (!viewport) return;

          var reduce = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
          if (reduce) return; // respect reduced motion

          var reel = viewport.querySelector('.slot-reel');
          var items = reel ? reel.querySelectorAll('.slot-item') : null;
          if (!reel || !items || items.length <= 2) return; // requires items + clone

          var hold = parseInt(viewport.getAttribute('data-hold'), 10);
          var speed = parseInt(viewport.getAttribute('data-speed'), 10);
          if (isNaN(hold)) hold = 2000;
          if (isNaN(speed)) speed = 600;

          function measure() {
            // Height: single item height from viewport line box
            slotH = Math.round(viewport.getBoundingClientRect().height);
            // Update current transform to align to current index without jump
            reel.style.transform = 'translateY(' + (-index * slotH) + 'px)';
          }

          var index = 0;
          var count = items.length - 1; // last is clone of first
          var slotH = 0;

          reel.style.setProperty('--slot-speed', speed + 'ms');

          // initial measure after fonts load/layout
          measure();

          // re-measure on resize
          var ro;
          if ('ResizeObserver' in window) {
            ro = new ResizeObserver(measure);
            ro.observe(viewport);
          } else {
            window.addEventListener('resize', measure);
          }

          function step() {
            index++;
            reel.style.transition = 'transform var(--slot-speed) cubic-bezier(.22,.8,.18,1)';
            reel.style.transform = 'translateY(' + (-index * slotH) + 'px)';

            if (index === count) {
              // when animation finishes to clone, snap back to 0 without visual change
              var onEnd = function () {
                reel.removeEventListener('transitionend', onEnd);
                reel.style.transition = 'none';
                index = 0;
                reel.style.transform = 'translateY(0)';
                // force reflow to apply transition none before restoring
                void reel.offsetHeight;
                reel.style.transition = 'transform var(--slot-speed) cubic-bezier(.22,.8,.18,1)';
              };
              reel.addEventListener('transitionend', onEnd);
            }
          }

          // start stepping
          setInterval(step, hold + speed);
        }

        function init() {
          initFigure();
          initSlot();
        }

        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', init);
        } else {
          init();
        }
      })();
    </script>

  </div>
</section>
