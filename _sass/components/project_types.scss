/* Project Types section — unified box with header, tabs row, and two-column content */
#project-types {
  /* Merge visually with the panel above; even tighter top gap, no bottom padding */
  padding: clamp(0.4rem, 1.8vw, 0.8rem) 0 0;

  &.panel-surface {
    border-top: 0; /* continue colour unbroken from previous panel */
    border-top-left-radius: 0;
    border-top-right-radius: 0;
    margin-top: 0; /* clean join with previous section */
  }


  .pt-header { padding: clamp(1.1rem, 3vw, 1.6rem); }
  .pt-header { padding-inline: var(--rail-gutter); }


  .pt-subtitle {
    opacity: 0.9;
    max-width: 60ch;
    margin: 0;
  }

  /* Tabs row spans full width under header */
  .pt-tablist {
    display: flex;
    gap: 0.5rem;
    padding: 0.75rem var(--rail-gutter);
    border-top: 1px solid var(--panel-edge);
    border-bottom: 1px solid var(--panel-edge);
    flex-wrap: wrap;
    background: rgba(255,255,255,0.02);
  }


  /* Panels wrap the two-column grid */
  .pt-panels {
    /* top/bottom spacing unchanged; unify side gutters to the rail */
    padding-top: clamp(0.5rem, 2.2vw, 1rem);
    padding-bottom: clamp(1.2rem, 3vw, 2rem);
    padding-inline: var(--rail-gutter);
  }

  /* Scales strip between tabs and content */
  .pt-scales {
    display: grid;
    grid-template-columns: 1fr;
    gap: 0.6rem;
    padding: clamp(0.6rem, 2vw, 0.9rem) 0 clamp(0.6rem, 2vw, 0.9rem);
    border-top: 1px dashed var(--panel-edge);
    border-bottom: 1px dashed var(--panel-edge);
    margin-bottom: clamp(0.4rem, 1.6vw, 0.8rem);
  }
  @media (min-width: 760px) {
    /* With two widgets (time + stages), fill the width evenly */
    .pt-scales { grid-template-columns: repeat(2, 1fr); }
  }

  .pt-scale {
    display: grid;
    /* Allow the middle column to shrink so contents can wrap on small screens */
    grid-template-columns: auto minmax(0, 1fr) auto;
    grid-template-areas: "label mid text";
    align-items: center;
    gap: 0.6rem;
    padding: 0.5rem 0.6rem;
    border-radius: 0.6rem;
    background: rgba(255,255,255,0.03);
    border: 1px solid rgba(255,255,255,0.08);
  }
  .pt-scale-label { grid-area: label; }
  .pt-scale-text { grid-area: text; }
  .pt-scale .pt-scale-dots,
  .pt-scale .pt-scale-toggle { grid-area: mid; }
  .pt-scale-label { opacity: 0.8; font-size: 0.9em; }
  .pt-scale-text { opacity: 0.9; font-size: 0.95em; }

  /* Time as 3 dots */
  .pt-scale.time .pt-scale-dots {
    display: inline-flex;
    gap: 0.4rem;
    flex-wrap: nowrap;
    flex: 0 0 auto; /* prevent shrinking/distortion of the dots row */
  }
  .pt-scale.time .dot {
    width: 10px; height: 10px; border-radius: 50%;
    flex: 0 0 auto; /* keep each dot fixed-size so it stays circular */
    background: rgba(255,255,255,0.18);
    box-shadow: inset 0 0 0 1px rgba(255,255,255,0.18);
  }
  .pt-scale.time[data-level="1"] .dot:nth-child(-n+1),
  .pt-scale.time[data-level="2"] .dot:nth-child(-n+2),
  .pt-scale.time[data-level="3"] .dot:nth-child(-n+3) {
    background: var(--accent-2);
    box-shadow: none;
  }

  /* Toggle chips for stages */
  .pt-scale-toggle {
    display: inline-flex;
    flex-wrap: wrap; /* wrap chips onto multiple lines on narrow screens */
    gap: 0.25rem;
    max-width: 100%;
  }

  /* Small screens: move the duration descriptor below the dots so dots don't get squished */
  @media (max-width: 420px) {
    .pt-scale.time {
      grid-template-columns: auto 1fr;
      grid-template-areas:
        "label mid"
        "text text";
    }
    .pt-scale.time .pt-scale-text { margin-top: 0.15rem; }
  }
  .pt-scale .opt {
    padding: 0.15rem 0.45rem;
    border-radius: 999px;
    font-size: 0.85em;
    border: 1px solid rgba(255,255,255,0.18);
    background: rgba(255,255,255,0.04);
    opacity: 0.7;
  }

  /* Stages widget: style chips like the .ff-step pills in the accordion */
  .pt-scale.stages .opt {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 2.1rem;
    height: 1.6rem;
    padding: 0; /* numeric pill, no inner padding */
    border-radius: 999px;
    font-weight: 700;
    font-size: 0.85em;
    text-shadow: 0 1px 2px rgba(0,0,0,0.45), 0 0 1px rgba(0,0,0,0.25);
    /* Neutral (non-selected) appearance matches is-off .ff-step */
    color: #e6e6e6;
    background: linear-gradient(180deg,
      color-mix(in oklab, var(--muted) 90%, white),
      color-mix(in oklab, var(--muted) 86%, black));
    border: 1px solid color-mix(in oklab, var(--muted) 50%, var(--panel-edge));
    opacity: 1; /* override base chip opacity */
  }
  /* Stages: highlight applicable ones with the same accent-2 gradient as .ff-step */
  .pt-scale.stages .opt.is-on {
    color: #fff;
    background: linear-gradient(180deg,
      color-mix(in oklab, var(--accent-2) 94%, white),
      color-mix(in oklab, var(--accent-2) 88%, black));
    border: 1px solid var(--panel-edge);
    opacity: 1;
  }
  /* Removed legacy phases toggle styles */

  .pt-panel { outline: none; }

  .pt-grid {
    display: grid;
    grid-template-columns: 1fr;
    column-gap: 0;
    row-gap: 0;
    border-top: 1px solid var(--panel-edge); /* separator below tabs */
    @media (min-width: 900px) {
      grid-template-columns: 1fr 1fr;
    }
  }

  .pt-col {
    padding: clamp(0.9rem, 2.2vw, 1.1rem);
  }

  /* Internal dividers for the “table” look */
  .pt-grid > .pt-col + .pt-col {
    border-top: 1px solid var(--panel-edge);
  }
  @media (min-width: 900px) {
    .pt-grid > .pt-col + .pt-col {
      border-top: 0;
      border-left: 1px solid var(--panel-edge);
    }
  }

  .pt-list {
    margin: 0.25rem 0 1rem;
    padding-left: 1.1rem;
  }
  .pt-list li { margin: 0.25rem 0; }
  .pt-list li::marker { color: var(--accent-1); }

  /* Characteristics: emphasize heading term, keep description readable */
  .pt-chars .pt-char-head {
    font-weight: 600;
  }
  .pt-chars .pt-char-desc {
    opacity: 0.95;
  }
  /* Characteristics: ensure standard bullets */
  .pt-chars { list-style: disc; }

  /* Removed unused pt-steps list styles */

  /* Removed unused pt-note style */
}

/* Merge-in: Flexible Project Framework styles previously in _flexible_framework.scss */
#project-types {
  /* Radiused background container for standalone page and homepage CTA section */
  .ff-box {
    position: relative;
    overflow: hidden;
    border-radius: 1rem;
    border-bottom-left-radius: 0;
    border-bottom-right-radius: 0;
    border-bottom: 0; /* section border provides bottom edge */
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  }

  /* Header grid and CTA area (used by homepage CTA include) */
  .pt-header {
    display: grid;
    grid-template-columns: 1fr; /* stack by default (mobile) */
    grid-template-areas:
      "title"
      "subtitle"
      "cta";
    gap: 0.6rem;
    align-items: start;
    position: relative;
    z-index: 0;
  }
  .pt-header > h2 { grid-area: title; margin: 0; }
  .pt-header > .pt-subtitle { grid-area: subtitle; }
  .pt-header > .fp-cta { grid-area: cta; justify-self: stretch; align-self: stretch; }

  @media (min-width: 900px) {
    .pt-header {
      grid-template-columns: 1fr 1fr;
      grid-template-areas:
        "title cta"
        "subtitle cta";
    }
    .pt-header > .fp-cta { justify-self: stretch; align-self: stretch; }
  }

  /* CTA background pattern + edge fading */
  .fp-cta { position: relative; z-index: 0; }
  .fp-cta::before {
    content: "";
    position: absolute;
    top: -16px; right: -16px; bottom: -16px; left: 0;
    background-image: url('/assets/images/node_loop_background.png');
    background-repeat: repeat;
    background-position: right 0 top -128px;
    background-size: 512px 512px;
    opacity: 0.18;
    pointer-events: none;
    z-index: -1;
    -webkit-mask-image:
      linear-gradient(to right, rgba(0,0,0,0) 0, rgba(0,0,0,1) 36px, rgba(0,0,0,1) calc(100% - 8px), rgba(0,0,0,0) 100%),
      linear-gradient(to bottom, rgba(0,0,0,0) 0, rgba(0,0,0,1) 8px, rgba(0,0,0,1) calc(100% - 8px), rgba(0,0,0,0) 100%);
            mask-image:
      linear-gradient(to right, rgba(0,0,0,0) 0, rgba(0,0,0,1) 36px, rgba(0,0,0,1) calc(100% - 8px), rgba(0,0,0,0) 100%),
      linear-gradient(to bottom, rgba(0,0,0,0) 0, rgba(0,0,0,1) 8px, rgba(0,0,0,1) calc(100% - 8px), rgba(0,0,0,0) 100%);
    -webkit-mask-composite: source-in;
            mask-composite: intersect;
  }
  .fp-cta { display: flex; margin: 0; justify-content: flex-start; align-items: center; }
  @media (max-width: 899px) { .pt-header > .fp-cta { margin-top: 0.6rem; } }
  @media (min-width: 900px) { .fp-cta { justify-content: center; } }
  .fp-arrow-link { @extend .btn-pill; }
  .fp-arrow-link.btn--accent-2 { --btn-accent: color-mix(in oklab, var(--accent-2) 74%, black); }
  .fp-arrow { display: block; transition: transform 120ms ease; }
  .fp-arrow-link:hover .fp-arrow { transform: translateX(3px); }

  /* Accordion styling */
  .ff-accordion { margin-top: 1rem; display: grid; gap: 0.6rem; }
  .ff-accordion details { border: 1px solid var(--panel-edge); border-radius: 0.6rem; background: color-mix(in oklab, var(--panel) 92%, black); overflow: hidden; position: relative; transition: background-color 140ms ease, border-color 140ms ease, opacity 140ms ease, filter 140ms ease; }
  .ff-accordion summary { cursor: pointer; list-style: none; padding: 0.8rem 1rem; display: flex; align-items: center; gap: 0.6rem; user-select: none; }
  .ff-accordion summary::-webkit-details-marker { display: none; }
  .ff-accordion summary::after { content: '\25BC'; margin-left: auto; font-size: 0.9em; transform: rotate(0deg); transition: transform 120ms ease; }
  .ff-accordion details[open] summary::after { transform: rotate(-180deg); }
  .ff-step { display: inline-flex; align-items: center; justify-content: center; font-weight: 700; font-size: 0.85em; color: #fff; background: linear-gradient(180deg, color-mix(in oklab, var(--accent-2) 94%, white), color-mix(in oklab, var(--accent-2) 88%, black)); border: 1px solid var(--panel-edge); width: 2.1rem; height: 1.6rem; border-radius: 999px; text-shadow: 0 1px 2px rgba(0,0,0,0.45), 0 0 1px rgba(0,0,0,0.25); }
  .ff-accordion .ff-panel { padding: 0 1rem 0.9rem; }
}

/* Full-page framework: stretch inner frame and show robot image */
body.ff-page #project-types .ff-box { flex: 1 1 auto; display: flex; flex-direction: column; min-height: 100%; border-bottom-left-radius: 1rem; border-bottom-right-radius: 1rem; border-bottom: 1px solid var(--panel-edge); }
body.ff-page #project-types .ff-body { flex: 1 1 auto; }
body.ff-page #project-types { padding: var(--section-pad-y) 0; }
#project-types .ff-body { padding-inline: var(--rail-gutter); padding-bottom: clamp(1rem, 3vw, 1.5rem); }
body.ff-page #project-types .pt-header { --ff-artw: clamp(220px, 27vw, 330px); --ff-imgw: clamp(180px, 24vw, 320px); }
@media (min-width: 900px) {
  body.ff-page #project-types .pt-header { grid-template-columns: 1fr var(--ff-artw); grid-template-areas: "title art" "subtitle art"; column-gap: clamp(12px, 2vw, 24px); padding-right: 0; }
  body.ff-page #project-types .pt-header .ff-robot { grid-area: art; position: static; justify-self: center; align-self: center; width: var(--ff-imgw); height: auto; object-fit: contain; pointer-events: none; filter: drop-shadow(0 1px 2px rgba(0,0,0,0.45)) drop-shadow(0 0 1px rgba(0,0,0,0.25)); transform: translateX(-12%); }
}
@media (min-width: 900px) and (max-width: 1200px) {
  body.ff-page #project-types .pt-header { column-gap: clamp(16px, 3vw, 28px); }
  body.ff-page #project-types .pt-header .pt-subtitle { max-width: 52ch; }
}
@media (max-width: 899px) {
  body.ff-page #project-types .pt-header .ff-robot { position: absolute; left: 50%; top: 0.2rem; transform: translateX(-50%); width: clamp(220px, 78vw, 420px); height: auto; opacity: 0.08; filter: none; pointer-events: none; }
  body.ff-page #project-types .pt-header > h2,
  body.ff-page #project-types .pt-header > .pt-subtitle { position: relative; z-index: 1; }
}

/* Stage applicability emphasis */
#project-types .ff-accordion details.is-off { opacity: 0.5; }
#project-types .ff-accordion details.is-off:hover { opacity: 0.65; }
#project-types .ff-accordion details.is-off summary { filter: saturate(0.7); }
#project-types .ff-accordion details.is-off .ff-step { color: #e6e6e6; background: linear-gradient(180deg, color-mix(in oklab, var(--muted) 90%, white), color-mix(in oklab, var(--muted) 86%, black)); border-color: color-mix(in oklab, var(--muted) 50%, var(--panel-edge)); }
#project-types .ff-accordion details:not(.is-off) { background: color-mix(in oklab, var(--panel) 88%, black); border-color: color-mix(in oklab, var(--accent-2) 35%, var(--panel-edge)); }
#project-types .ff-accordion details:not(.is-off)::before { content: ""; position: absolute; left: 0; top: 0; bottom: 0; width: 3px; background: var(--accent-2); opacity: 0.9; }
#project-types .ff-accordion details:not(.is-off):hover { background: color-mix(in oklab, var(--panel) 84%, black); border-color: color-mix(in oklab, var(--accent-2) 50%, var(--panel-edge)); }

/* Framework page tweaks */
body.ff-page #project-types .pt-scales { border-top: 0; border-bottom: 0; }
body.ff-page #project-types .ff-accordion { margin-bottom: clamp(0.2rem, 0.8vw, 0.6rem); }
body.ff-page #project-types .pt-panels { padding-top: 0; }

